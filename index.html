<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì˜ê³¼ê³  inside</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .dc-table-header { border-top: 2px solid #333; }
    .loader { 
      border: 4px solid #f3f3f3; 
      border-top: 4px solid #3B4890; 
      border-radius: 50%; 
      width: 20px; 
      height: 20px; 
      animation: spin 1s linear infinite; 
      display: inline-block; 
      margin-left: 8px; 
      vertical-align: middle; 
    }
    @keyframes spin { 
      0% { transform: rotate(0deg); } 
      100% { transform: rotate(360deg); } 
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }
    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background-color: white;
      padding: 2rem;
      border-radius: 0.5rem;
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen text-gray-800">

<!-- Header -->
<header class="w-full bg-white text-[#3B4890] shadow-md sticky top-0 z-10">
  <div class="max-w-5xl mx-auto p-4 flex justify-between items-center">
    <h1 class="text-3xl font-bold cursor-pointer" onclick="showMain()">ì˜ê³¼ê³ inside</h1>
    <div class="flex gap-2">
      <button id="refreshButton" class="bg-[#3B4890] text-white font-semibold py-1 px-3 rounded text-sm hover:bg-[#2F3A78] transition">
        ğŸ”„ ìƒˆë¡œê³ ì¹¨
      </button>
    </div>
  </div>
</header>

<div id="app" class="max-w-5xl mx-auto p-4">
  <!-- ìƒë‹¨ ë²„íŠ¼ -->
  <div class="mb-4 bg-[#3B4890] p-2 rounded-lg shadow-md">
    <button onclick="openGuide()" class="bg-gray-200 text-[#3B4890] px-4 py-2 rounded shadow hover:bg-gray-300 transition-colors font-semibold">
      ğŸ“¢ ì•ˆë‚´ì‚¬í•­
    </button>
    <button onclick="openInquiry()" class="bg-gray-200 text-[#3B4890] px-4 py-2 rounded shadow hover:bg-gray-300 transition-colors ml-2 font-semibold">
      âœ‰ï¸ ë¬¸ì˜í•˜ê¸°
    </button>
  </div>

  <!-- ì•ˆë‚´ì‚¬í•­ í˜ì´ì§€ -->
  <div id="guidePage" class="hidden bg-white p-6 rounded-lg shadow-md mb-6">
    <button onclick="closeGuide()" class="bg-gray-200 px-3 py-1 rounded mb-4 hover:bg-gray-300 text-sm font-semibold">
      â† ëŒì•„ê°€ê¸°
    </button>
    <h2 class="text-2xl font-bold mb-4 border-b pb-2">ğŸ“¢ ì•ˆë‚´ì‚¬í•­</h2>
    <div class="space-y-2 text-gray-700">
      <p>1. ìš•ì„¤, ë¹„ë°© ê¸ˆì§€.</p>
      <p>2. ì‘ì„±ê¸€ ì±…ì„ì€ ë³¸ì¸ì—ê²Œ ìˆìŠµë‹ˆë‹¤.</p>
      <p class="pl-4 text-sm">IP ìˆ˜ì§‘ì¤‘ì´ë©° í…ŒëŸ¬ë‚˜ ë¬¸ì œë˜ëŠ” ìƒí™©ì´ ì•„ë‹Œ ë‹¤ë¥¸ ìš©ë„ë¡œ ì ˆëŒ€ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
      <p>3. ì„œë²„ ìì›ì´ ë¶€ì¡±í•  ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì— ì§€ì—°ì´ ë°œìƒí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p>
      <p>4. í…ŒëŸ¬ í•˜ì§€ ë§ˆì„¸ìš” (IPì£¼ì†Œë¡œ ë³´ë³µí•©ë‹ˆë‹¤.)</p>
      <p>5. ì—¬ëŸ¬ë¶„ì´ ê²Œì‹œí•œ ê¸€ë“¤ì€ AI í•™ìŠµ ë°ì´í„°ë¡œ ì‚¬ìš©ë˜ë©° ìµëª…ì„ ë³´ì¥í•©ë‹ˆë‹¤.</p>
      <p>6. í•˜ì§€ë§Œ ê°œì¸ì •ë³´ë¥¼ ê²Œì‹œí•  ê²½ìš° í•™ìŠµë  ìˆ˜ë„ ìˆìœ¼ë‹ˆ ê°€ê¸‰ì  ê°œì¸ì •ë³´ ê²Œì‹œë¥¼ ìì œí•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.</p>
      <p>7. ë¬¸ì˜ì‚¬í•­ì€ ë¬¸ì˜í•˜ê¸°ì—ì„œ ì‘ì„±í•´ì£¼ì„¸ìš”.</p>
      <p>8. ë²„ê·¸ë‚˜ ë¬¸ì œì ë“±ë„ ë¬¸ì˜í•˜ê¸°ì—ì„œ ì‘ì„±í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤.</p>
      <p>9. ì¶”í›„ ì—…ë°ì´íŠ¸ê°€ ê³„ì† ì§„í–‰ë©ë‹ˆë‹¤.</p>
      <p>10. ì´ ì‚¬ì´íŠ¸ì—ì„œ í™œë™í•˜ëŠ”ê²ƒì€ ìœ„ ì‚¬í•­ì— ë™ì˜í•˜ëŠ”ê²ƒìœ¼ë¡œ ê°„ì£¼í•©ë‹ˆë‹¤.</p>
      
      
      <!--
      <p>11. ì‚­ì œ ìš”ì²­ì€ ì•„ë˜ ì´ë©”ì¼ë¡œ ì •í™•í•œ ê¸€ê³¼ ì‚¬ìœ , ìº¡ì³ë³¸ì„ ë³´ë‚´ì£¼ì…”ì•¼ ì§„í–‰ë©ë‹ˆë‹¤.</p>
      <p class="font-semibold">ì´ë©”ì¼ : 2024010203@ushs.hs.kr</p>
    -->
    
    </div>
  </div>

  <!-- ë¬¸ì˜í•˜ê¸° í˜ì´ì§€ -->
  <div id="inquiryPage" class="hidden bg-white p-6 rounded-lg shadow-md mb-6">
    <button onclick="closeInquiry()" class="bg-gray-200 px-3 py-1 rounded mb-4 hover:bg-gray-300 text-sm font-semibold">
      â† ëŒì•„ê°€ê¸°
    </button>
    <h2 class="text-2xl font-bold mb-4 border-b pb-2">âœ‰ï¸ ë¬¸ì˜í•˜ê¸°</h2>
    <textarea id="inquiryContent" placeholder="ë¬¸ì˜ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..." class="border p-2 mb-2 w-full rounded h-32 focus:outline-none focus:ring-2 focus:ring-[#3B4890]"></textarea>
    <button onclick="submitInquiry()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition-colors">
      ë¬¸ì˜ ì „ì†¡
    </button>
    <p id="inquiryMsg" class="mt-2 text-sm"></p>
  </div>

  <!-- ë©”ì¸ í˜ì´ì§€ (ì»¤ë®¤ë‹ˆí‹° ëª©ë¡) -->
  <div id="mainPage" class="grid gap-4 mb-6"></div>

  <!-- ì»¤ë®¤ë‹ˆí‹° í˜ì´ì§€ (ê²Œì‹œê¸€ ëª©ë¡) -->
  <div id="communityPage" class="hidden">
    <button onclick="showMain()" class="bg-gray-200 border border-gray-300 px-3 py-1 rounded mb-4 hover:bg-gray-300 text-sm font-semibold">
      â† ë©”ì¸ìœ¼ë¡œ
    </button>
    <h2 id="communityTitle" class="text-3xl font-bold mb-4 text-[#3B4890]"></h2>
    
    <!-- ê¸€ì“°ê¸° í¼ -->
    <div id="postWriteForm" class="bg-white p-4 rounded-lg shadow-md mb-4">
      <input id="authorNickname" placeholder="ë‹‰ë„¤ì„" class="border w-full p-2 mb-2 rounded focus:outline-none focus:ring-2 focus:ring-[#3B4890]" />
      <input id="title" placeholder="ì œëª©" class="border w-full p-2 mb-2 rounded focus:outline-none focus:ring-2 focus:ring-[#3B4890]" />
      <textarea id="content" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" class="border w-full p-2 mb-2 rounded h-28 focus:outline-none focus:ring-2 focus:ring-[#3B4890]"></textarea>
      <input id="postPassword" type="password" placeholder="ê²Œì‹œê¸€ ë¹„ë°€ë²ˆí˜¸ (ìˆ˜ì •/ì‚­ì œ ì‹œ í•„ìš”)" class="border w-full p-2 mb-2 rounded focus:outline-none focus:ring-2 focus:ring-[#3B4890]" />
      <div class="mb-2">
        <label for="imageFile" class="block text-sm font-medium text-gray-700 mb-1">ì´ë¯¸ì§€ ì²¨ë¶€ (ì„ íƒ, 2MB ì´í•˜):</label>
        <input type="file" id="imageFile" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-[#e0e7ff] file:text-[#3B4890] hover:file:bg-[#c7d2fe]">
      </div>
      <button id="submitBtn" onclick="submitPost()" class="bg-[#3B4890] text-white px-4 py-2 rounded hover:bg-[#2F3A78] transition-colors font-semibold disabled:opacity-50">
        ê¸€ ë“±ë¡
      </button>
      <span id="loadingSpinner" class="loader hidden"></span>
      <p id="resultMsg" class="mt-2 text-sm"></p>
    </div>

    <!-- ê²€ìƒ‰ -->
    <input id="searchBox" type="text" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”." oninput="renderPosts()" class="border w-full p-2 mb-4 rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-[#3B4890]" />

    <!-- ê²Œì‹œê¸€ ëª©ë¡ -->
    <div id="postsList" class="bg-white rounded-lg shadow-md overflow-hidden">
      <table class="w-full text-sm dc-table-header">
        <thead class="bg-gray-50">
          <tr class="border-b">
            <th class="p-3 text-left">ì œëª©</th>
            <th class="p-3 w-24">ì‘ì„±ì</th>
            <th class="p-3 w-28">ë‚ ì§œ</th>
            <th class="p-3 w-16">ì¡°íšŒ</th>
          </tr>
        </thead>
        <tbody id="postsTableBody"></tbody>
      </table>
    </div>

    <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
    <div id="pagination" class="flex justify-center items-center gap-2 mt-4 mb-4">
      <button onclick="goToPage(1)" class="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300 text-sm font-semibold disabled:opacity-50" id="firstPageBtn">
        â‰ª ì²« í˜ì´ì§€
      </button>
      <button onclick="goToPage(currentPage - 1)" class="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300 text-sm font-semibold disabled:opacity-50" id="prevPageBtn">
        â€¹ ì´ì „
      </button>
      <span id="pageInfo" class="px-4 py-1 text-sm font-semibold text-gray-700"></span>
      <button onclick="goToPage(currentPage + 1)" class="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300 text-sm font-semibold disabled:opacity-50" id="nextPageBtn">
        ë‹¤ìŒ â€º
      </button>
      <button onclick="goToPage(totalPages)" class="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300 text-sm font-semibold disabled:opacity-50" id="lastPageBtn">
        ë§ˆì§€ë§‰ í˜ì´ì§€ â‰«
      </button>
    </div>

    <!-- ê²Œì‹œê¸€ ìƒì„¸ -->
    <div id="postDetail" class="hidden bg-white p-6 rounded-lg shadow-md">
      <button onclick="backToList()" class="bg-gray-200 border border-gray-300 px-3 py-1 rounded mb-4 hover:bg-gray-300 text-sm font-semibold">
        â† ëª©ë¡ìœ¼ë¡œ
      </button>
      <div class="border-b-2 border-gray-300 pb-3 mb-3">
        <h2 id="detailTitle" class="text-2xl font-bold mb-2"></h2>
        <div id="detailMeta" class="text-sm text-gray-600 bg-gray-50 p-2 rounded"></div>
        <div id="detailActions" class="mt-2 flex gap-2"></div>
      </div>
      <div id="detailImageContainer" class="mb-4"></div>
      <div id="detailContentDisplay" class="mb-5 whitespace-pre-wrap min-h-[100px]"></div>
      <div id="detailEditForm" class="hidden mb-5">
        <textarea id="editContent" class="border w-full p-2 rounded h-40 focus:outline-none focus:ring-2 focus:ring-[#3B4890]"></textarea>
        <div class="mt-2 flex gap-2">
          <button onclick="submitUpdate()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">ì™„ë£Œ</button>
          <button onclick="cancelEdit()" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">ì·¨ì†Œ</button>
        </div>
      </div>

      <!-- ëŒ“ê¸€ -->
      <div class="border-t pt-4">
        <h3 class="font-bold mb-3 text-lg">ğŸ’¬ ëŒ“ê¸€</h3>
        <div id="commentsList" class="mb-4"></div>
        <div class="bg-gray-50 p-3 rounded">
          <input id="commentAuthor" placeholder="ë‹‰ë„¤ì„" class="border p-2 mb-2 w-full rounded focus:outline-none focus:ring-2 focus:ring-[#3B4890]" />
          <textarea id="commentContent" placeholder="ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" class="border p-2 mb-2 w-full rounded h-20 focus:outline-none focus:ring-2 focus:ring-[#3B4890]"></textarea>
          <button onclick="submitComment()" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 font-semibold">ëŒ“ê¸€ ë“±ë¡</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ëª¨ë‹¬ -->
<div id="passwordModal" class="modal">
  <div class="modal-content">
    <h2 class="text-2xl font-bold mb-4">ğŸ”’ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</h2>
    <p class="mb-4 text-gray-600">ê²Œì‹œê¸€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
    <input id="modalPasswordInput" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" class="border w-full p-2 mb-2 rounded focus:outline-none focus:ring-2 focus:ring-[#3B4890]" />
    <p id="modalPasswordError" class="text-red-500 text-sm mb-2"></p>
    <div class="flex gap-2">
      <button onclick="submitPasswordModal()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 flex-1">í™•ì¸</button>
      <button onclick="closePasswordModal()" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400 flex-1">ì·¨ì†Œ</button>
    </div>
  </div>
</div>

<script>
  // ===== í™˜ê²½ ì„¤ì • =====
  // ğŸ”¥ ì¤‘ìš”: ì•„ë˜ URLì„ Apps Script ì›¹ ì•± URLë¡œ ë³€ê²½í•˜ì„¸ìš”!
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyGYTBqjwYzF8H0QMenSj0tfLfYhYjZfYM7PT3c86iEFWAJD4KpVick1z0hu3YHE0ALaw/exec";

  // ===== ì»¤ë®¤ë‹ˆí‹° ì„¤ì • =====
  const communityGroups = {
    "ì „ì²´": ["ì „ì²´ ì»¤ë®¤ë‹ˆí‹°"],
    "ìˆ˜í•™Â·ê³¼í•™": ["ìˆ˜í•™ ì»¤ë®¤ë‹ˆí‹°", "ê³¼í•™ ì»¤ë®¤ë‹ˆí‹°"],
    "ì˜ì¬í•™êµ": [
      "í•œêµ­ê³¼í•™ì˜ì¬í•™êµ", "ì„œìš¸ê³¼í•™ê³ ë“±í•™êµ", "ê²½ê¸°ê³¼í•™ê³ ë“±í•™êµ", "ì„¸ì¢…ê³¼í•™ì˜ˆìˆ ì˜ì¬í•™êµ",
      "ì¸ì²œê³¼í•™ì˜ˆìˆ ì˜ì¬í•™êµ", "ëŒ€êµ¬ê³¼í•™ê³ ë“±í•™êµ", "ëŒ€ì „ê³¼í•™ê³ ë“±í•™êµ", "ê´‘ì£¼ê³¼í•™ê³ ë“±í•™êµ"
    ],
    "ê³¼í•™ê³ ": [
      "í•œì„±ê³¼í•™ê³ ë“±í•™êµ", "ì„¸ì¢…ê³¼í•™ê³ ë“±í•™êµ", "ë¶€ì‚°ê³¼í•™ê³ ë“±í•™êµ", "ë¶€ì‚°ì¼ê³¼í•™ê³ ë“±í•™êµ",
      "ëŒ€êµ¬ì¼ê³¼í•™ê³ ë“±í•™êµ", "ì¸ì²œê³¼í•™ê³ ë“±í•™êµ", "ì¸ì²œì§„ì‚°ê³¼í•™ê³ ë“±í•™êµ", "ëŒ€ì „ë™ì‹ ê³¼í•™ê³ ë“±í•™êµ",
      "ìš¸ì‚°ê³¼í•™ê³ ë“±í•™êµ", "ê²½ê¸°ë¶ê³¼í•™ê³ ë“±í•™êµ", "ê°•ì›ê³¼í•™ê³ ë“±í•™êµ", "ì¶©ë¶ê³¼í•™ê³ ë“±í•™êµ",
      "ì¶©ë‚¨ê³¼í•™ê³ ë“±í•™êµ", "ì „ë¶ê³¼í•™ê³ ë“±í•™êµ", "ì „ë‚¨ê³¼í•™ê³ ë“±í•™êµ", "ê²½ë¶ê³¼í•™ê³ ë“±í•™êµ",
      "ê²½ì‚°ê³¼í•™ê³ ë“±í•™êµ", "ê²½ë‚¨ê³¼í•™ê³ ë“±í•™êµ", "ì°½ì›ê³¼í•™ê³ ë“±í•™êµ", "ì œì£¼ê³¼í•™ê³ ë“±í•™êµ"
    ]
  };

  // ===== ì „ì—­ ë³€ìˆ˜ =====
  let currentCommunity = null;
  let currentPosts = [];
  let currentPostId = null;
  let currentPasswordModalAction = null;
  let currentPage = 1;
  let totalPages = 1;
  let postsPerPage = 10;

  // ===== ì´ˆê¸°í™” =====
  function init() {
    // URL ì„¤ì • í™•ì¸
    if (!WEB_APP_URL || WEB_APP_URL.includes("YOUR_APPS_SCRIPT")) {
      console.warn("âš ï¸ WEB_APP_URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. HTML íŒŒì¼ì„ ìˆ˜ì •í•´ì£¼ì„¸ìš”.");
    }
    
    renderMainPage();
    
    // ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼
    document.getElementById('refreshButton').addEventListener('click', () => {
      if (currentCommunity) {
        loadPosts(currentPage);
      } else {
        renderMainPage();
      }
    });
  }

  // ===== í˜ì´ì§€ ì „í™˜ í•¨ìˆ˜ë“¤ =====
  function showMain() {
    currentCommunity = null;
    currentPosts = [];
    currentPostId = null;
    document.getElementById("mainPage").classList.remove("hidden");
    document.getElementById("communityPage").classList.add("hidden");
    document.getElementById("guidePage").classList.add("hidden");
    document.getElementById("inquiryPage").classList.add("hidden");
  }

  function openGuide() {
    document.getElementById("mainPage").classList.add("hidden");
    document.getElementById("communityPage").classList.add("hidden");
    document.getElementById("guidePage").classList.remove("hidden");
    document.getElementById("inquiryPage").classList.add("hidden");
  }

  function closeGuide() {
    document.getElementById("guidePage").classList.add("hidden");
    document.getElementById("mainPage").classList.remove("hidden");
  }

  function openInquiry() {
    document.getElementById("mainPage").classList.add("hidden");
    document.getElementById("communityPage").classList.add("hidden");
    document.getElementById("guidePage").classList.add("hidden");
    document.getElementById("inquiryPage").classList.remove("hidden");
  }

  function closeInquiry() {
    document.getElementById("inquiryPage").classList.add("hidden");
    document.getElementById("mainPage").classList.remove("hidden");
    document.getElementById("inquiryContent").value = "";
    document.getElementById("inquiryMsg").textContent = "";
  }

  function openCommunity(communityId) {
    if (!WEB_APP_URL || WEB_APP_URL.includes("YOUR_APPS_SCRIPT")) {
      alert("ì˜¤ë¥˜: ì›¹ ì•± URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\n\nHTML íŒŒì¼ì—ì„œ WEB_APP_URL ë³€ìˆ˜ë¥¼ Apps Script ë°°í¬ URLë¡œ ë³€ê²½í•´ì£¼ì„¸ìš”.");
      return;
    }
    
    currentCommunity = communityId;
    currentPage = 1;
    
    document.getElementById("mainPage").classList.add("hidden");
    document.getElementById("communityPage").classList.remove("hidden");
    document.getElementById("guidePage").classList.add("hidden");
    document.getElementById("inquiryPage").classList.add("hidden");
    document.getElementById("communityTitle").textContent = communityId;
    
    backToList();
    loadPosts(1);
  }

  // ===== ë©”ì¸ í˜ì´ì§€ ë Œë”ë§ =====
  function renderMainPage() {
    const mainPage = document.getElementById("mainPage");
    mainPage.innerHTML = "";
    
    Object.keys(communityGroups).forEach(groupName => {
      const container = document.createElement("div");
      container.className = "bg-white p-4 rounded-lg shadow-md mb-4";
      
      const header = document.createElement("h3");
      header.className = "font-bold text-lg mb-3 border-b-2 border-[#3B4890] pb-2";
      header.textContent = groupName;
      container.appendChild(header);
      
      const btnDiv = document.createElement("div");
      btnDiv.className = "flex flex-wrap gap-2";
      
      communityGroups[groupName].forEach(c => {
        const btn = document.createElement("button");
        btn.className = "bg-white border border-gray-300 text-gray-700 px-3 py-1 rounded text-sm hover:bg-gray-50 hover:border-[#3B4890] hover:text-[#3B4890] transition-colors";
        btn.textContent = c;
        btn.onclick = () => openCommunity(c);
        btnDiv.appendChild(btn);
      });
      
      container.appendChild(btnDiv);
      mainPage.appendChild(container);
    });
  }

  // ===== ê²Œì‹œê¸€ ê´€ë¦¬ =====
  async function loadPosts(page = 1) {
    if (!currentCommunity) return;

    currentPage = page;
    const postsTableBody = document.getElementById("postsTableBody");
    postsTableBody.innerHTML = '<tr><td colspan="4" class="p-4 text-center text-gray-500">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>';

    try {
      const response = await fetch(`${WEB_APP_URL}?action=getPosts&community=${encodeURIComponent(currentCommunity)}&page=${page}`);
      
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }
      
      const data = await response.json();

      if (data && data.success === false) {
        postsTableBody.innerHTML = `<tr><td colspan="4" class="p-4 text-center text-red-500">ì˜¤ë¥˜: ${data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}</td></tr>`;
        currentPosts = [];
        return;
      }

      if (data.success && Array.isArray(data.posts)) {
        currentPosts = data.posts;
        totalPages = Math.ceil(data.totalPosts / postsPerPage);
        if (totalPages === 0) totalPages = 1;
        renderPosts();
        renderPagination();
      } else {
        postsTableBody.innerHTML = '<tr><td colspan="4" class="p-4 text-center text-red-500">ë°ì´í„° í˜•ì‹ ì˜¤ë¥˜.</td></tr>';
        currentPosts = [];
      }
    } catch (err) {
      console.error("getPosts ì˜¤ë¥˜:", err);
      postsTableBody.innerHTML = `<tr><td colspan="4" class="p-4 text-center text-red-500">ê²Œì‹œê¸€ ë¡œë“œ ì‹¤íŒ¨: ${err.message}<br><small class="text-gray-500">Apps Script URLì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•˜ì„¸ìš”.</small></td></tr>`;
      currentPosts = [];
    }
  }

  function renderPagination() {
    const pageInfo = document.getElementById('pageInfo');
    const firstBtn = document.getElementById('firstPageBtn');
    const prevBtn = document.getElementById('prevPageBtn');
    const nextBtn = document.getElementById('nextPageBtn');
    const lastBtn = document.getElementById('lastPageBtn');

    pageInfo.textContent = `${currentPage} / ${totalPages} í˜ì´ì§€`;

    firstBtn.disabled = currentPage === 1;
    prevBtn.disabled = currentPage === 1;
    nextBtn.disabled = currentPage >= totalPages;
    lastBtn.disabled = currentPage >= totalPages;

    [firstBtn, prevBtn, nextBtn, lastBtn].forEach(btn => {
      if (btn.disabled) {
        btn.classList.add('cursor-not-allowed', 'opacity-50');
      } else {
        btn.classList.remove('cursor-not-allowed', 'opacity-50');
      }
    });
  }

  function goToPage(page) {
    if (page < 1 || page > totalPages) return;
    loadPosts(page);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  function renderPosts() {
    const search = document.getElementById("searchBox").value.toLowerCase();
    const postsTableBody = document.getElementById("postsTableBody");
    postsTableBody.innerHTML = "";

    if (!Array.isArray(currentPosts)) {
      postsTableBody.innerHTML = "<tr><td colspan='4' class='p-4 text-center text-red-500'>ë°ì´í„° ì˜¤ë¥˜ ë°œìƒ.</td></tr>";
      return;
    }

    const filtered = currentPosts.filter(p => {
      if (!p || typeof p !== 'object') return false;
      const titleMatch = typeof p.title === 'string' && p.title.toLowerCase().includes(search);
      const authorMatch = typeof p.authorNickname === 'string' && p.authorNickname.toLowerCase().includes(search);
      return titleMatch || authorMatch;
    });

    if (filtered.length === 0) {
      postsTableBody.innerHTML = "<tr><td colspan='4' class='p-4 text-center text-gray-500'>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>";
      return;
    }

    filtered.forEach((p, index) => {
      if (!p || !p.postId) {
        console.warn(`Invalid post at index ${index}:`, p);
        return;
      }

      const tr = document.createElement("tr");
      tr.className = "border-b cursor-pointer hover:bg-gray-50 transition-colors";

      let dateOnly = '';
      if (p.timestamp) {
        try {
          dateOnly = p.timestamp.split(' ')[0].replace(/\.$/, '');
        } catch (e) {
          console.warn(`Timestamp parse error for post ${p.postId}:`, p.timestamp);
        }
      }

      const tdTitle = document.createElement("td");
      tdTitle.className = "p-3";
      tdTitle.textContent = p.title || "";
      tr.appendChild(tdTitle);

      const tdAuthor = document.createElement("td");
      tdAuthor.className = "p-3 w-24 text-center";
      tdAuthor.textContent = p.authorNickname || "ìµëª…";
      tr.appendChild(tdAuthor);

      const tdDate = document.createElement("td");
      tdDate.className = "p-3 w-28 text-center text-gray-600";
      tdDate.textContent = dateOnly;
      tr.appendChild(tdDate);

      const tdViews = document.createElement("td");
      tdViews.className = "p-3 w-16 text-center text-gray-600";
      tdViews.textContent = p.views !== undefined && p.views !== null ? p.views : 0;
      tr.appendChild(tdViews);

      tr.onclick = () => showDetail(p.postId);
      postsTableBody.appendChild(tr);
    });
  }

  async function submitPost() {
    const authorNickname = document.getElementById("authorNickname").value;
    const title = document.getElementById("title").value;
    const content = document.getElementById("content").value;
    const postPassword = document.getElementById("postPassword").value;
    const file = document.getElementById("imageFile").files[0];
    const submitButton = document.getElementById("submitBtn");
    const loadingSpinner = document.getElementById("loadingSpinner");
    const resultMsg = document.getElementById("resultMsg");

    if (!authorNickname || !title || !content) {
      resultMsg.textContent = "âŒ ë‹‰ë„¤ì„, ì œëª©, ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.";
      resultMsg.className = "mt-2 text-sm text-red-600";
      return;
    }

    if (!postPassword) {
      resultMsg.textContent = "âŒ ê²Œì‹œê¸€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.";
      resultMsg.className = "mt-2 text-sm text-red-600";
      return;
    }

    submitButton.disabled = true;
    loadingSpinner.classList.remove("hidden");
    resultMsg.textContent = "ë“±ë¡ ì¤‘...";
    resultMsg.className = "mt-2 text-sm text-gray-600";

    const postData = {
      communityId: currentCommunity,
      title: title,
      authorNickname: authorNickname,
      content: content,
      postPassword: postPassword,
      imageData: null,
      imageName: null,
      imageType: null
    };

    if (file) {
      if (file.size > 2 * 1024 * 1024) {
        resultMsg.textContent = "âŒ ì´ë¯¸ì§€ íŒŒì¼ í¬ê¸°ëŠ” 2MBë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
        resultMsg.className = "mt-2 text-sm text-red-600";
        submitButton.disabled = false;
        loadingSpinner.classList.add("hidden");
        document.getElementById("imageFile").value = "";
        return;
      }

      const reader = new FileReader();
      reader.onload = function (e) {
        const base64String = e.target.result.split(',')[1];
        if (!base64String) {
          resultMsg.textContent = "âŒ ì´ë¯¸ì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ.";
          resultMsg.className = "mt-2 text-sm text-red-600";
          submitButton.disabled = false;
          loadingSpinner.classList.add("hidden");
          return;
        }
        postData.imageData = base64String;
        postData.imageName = file.name;
        postData.imageType = file.type;
        callAddPostApi(postData);
      };
      reader.onerror = function (e) {
        console.error("íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:", e);
        resultMsg.textContent = "âŒ íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        resultMsg.className = "mt-2 text-sm text-red-600";
        submitButton.disabled = false;
        loadingSpinner.classList.add("hidden");
      };
      try {
        reader.readAsDataURL(file);
      } catch (readErr) {
        console.error("FileReader ì˜¤ë¥˜:", readErr);
        resultMsg.textContent = "âŒ íŒŒì¼ ì½ê¸° ì¤‘ ì˜¤ë¥˜ ë°œìƒ.";
        resultMsg.className = "mt-2 text-sm text-red-600";
        submitButton.disabled = false;
        loadingSpinner.classList.add("hidden");
      }
    } else {
      callAddPostApi(postData);
    }
  }

  async function callAddPostApi(dataToSend) {
    const submitButton = document.getElementById("submitBtn");
    const loadingSpinner = document.getElementById("loadingSpinner");
    const resultMsg = document.getElementById("resultMsg");

    try {
      const response = await fetch(WEB_APP_URL, {
        method: "POST",
        mode: "cors",
        cache: "no-cache",
        headers: { "Content-Type": "text/plain;charset=utf-8" },
        body: JSON.stringify({ action: "addPost", data: dataToSend })
      });

      const res = await response.json();

      if (res && res.success === true) {
        resultMsg.textContent = res.message || "âœ… ë“±ë¡ ì„±ê³µ";
        resultMsg.className = "mt-2 text-sm text-green-600";
        
        // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
        document.getElementById("authorNickname").value = "";
        document.getElementById("title").value = "";
        document.getElementById("content").value = "";
        document.getElementById("postPassword").value = "";
        document.getElementById("imageFile").value = "";
        
        setTimeout(() => { resultMsg.textContent = ""; }, 2000);
        
        // ì²« í˜ì´ì§€ë¡œ ì´ë™í•˜ì—¬ ìƒˆ ê¸€ í™•ì¸
        currentPage = 1;
        loadPosts(1);
      } else {
        resultMsg.textContent = res.message || "âŒ ë“±ë¡ ì‹¤íŒ¨";
        resultMsg.className = "mt-2 text-sm text-red-600";
        console.error("Server error:", res);
      }

      submitButton.disabled = false;
      loadingSpinner.classList.add("hidden");
    } catch (err) {
      console.error("addPost API ì˜¤ë¥˜:", err);
      resultMsg.textContent = `âŒ ì„œë²„ í†µì‹  ì˜¤ë¥˜: ${err.message}`;
      resultMsg.className = "mt-2 text-sm text-red-600";
      submitButton.disabled = false;
      loadingSpinner.classList.add("hidden");
    }
  }

  async function showDetail(postId) {
    if (!postId) {
      console.error("showDetail: Invalid postId");
      return;
    }

    const post = currentPosts.find(p => p && p.postId && p.postId.toString() === postId.toString());
    if (!post) {
      alert("ê²Œì‹œê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
      return;
    }

    currentPostId = postId;
    
    // UI ì „í™˜
    document.getElementById("postWriteForm").classList.add("hidden");
    document.getElementById("searchBox").classList.add("hidden");
    document.getElementById("postsList").classList.add("hidden");
    document.getElementById("pagination").classList.add("hidden");
    document.getElementById("postDetail").classList.remove("hidden");

    // ê²Œì‹œê¸€ ì •ë³´ í‘œì‹œ
    document.getElementById("detailTitle").textContent = post.title || "ì œëª© ì—†ìŒ";
    document.getElementById("detailMeta").textContent = `ì‘ì„±ì: ${post.authorNickname || "ìµëª…"} | ë‚ ì§œ: ${post.timestamp || "ì•Œ ìˆ˜ ì—†ìŒ"} | ì¡°íšŒìˆ˜: ${post.views || 0}`;

    // ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼
    const actionsEl = document.getElementById("detailActions");
    actionsEl.innerHTML = "";
    
    const editBtn = document.createElement("button");
    editBtn.className = "bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600";
    editBtn.textContent = "ìˆ˜ì •";
    editBtn.onclick = () => showPasswordModal('edit');
    actionsEl.appendChild(editBtn);

    const deleteBtn = document.createElement("button");
    deleteBtn.className = "bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600";
    deleteBtn.textContent = "ì‚­ì œ";
    deleteBtn.onclick = () => showPasswordModal('delete');
    actionsEl.appendChild(deleteBtn);

    // ì´ë¯¸ì§€ ì²˜ë¦¬
    const detailImageContainer = document.getElementById("detailImageContainer");
    detailImageContainer.innerHTML = "";

    if (post.imageId && typeof post.imageId === 'string' && post.imageId.trim() !== "") {
      const imageUrl = `${WEB_APP_URL}?action=getImage&id=${post.imageId}`;
      detailImageContainer.innerHTML = '<p class="text-gray-500 text-sm">ì´ë¯¸ì§€ ë¡œë”© ì¤‘...</p>';

      try {
        const response = await fetch(imageUrl);
        if (!response.ok) {
          throw new Error(`ì´ë¯¸ì§€ ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜ ${response.status}`);
        }

        const base64Content = await response.text();

        if (base64Content && typeof base64Content === 'string' && !base64Content.startsWith("Error") && base64Content.length > 100) {
          let mimeType = "image/unknown";
          const signature = base64Content.substring(0, 20);
          if (signature.startsWith("/9j/")) mimeType = "image/jpeg";
          else if (signature.startsWith("iVBORw")) mimeType = "image/png";
          else if (signature.startsWith("R0lGOD")) mimeType = "image/gif";
          else if (signature.startsWith("UklGR")) mimeType = "image/webp";
          else if (signature.startsWith("PHN2Zy")) mimeType = "image/svg+xml";

          const img = document.createElement("img");
          img.src = `data:${mimeType};base64,${base64Content}`;
          img.alt = (post.title || "ê²Œì‹œê¸€") + " ì´ë¯¸ì§€";
          img.className = "max-w-full h-auto rounded shadow my-4";
          img.onerror = () => {
            console.error("ì´ë¯¸ì§€ í‘œì‹œ ì‹¤íŒ¨:", post.imageId);
            detailImageContainer.innerHTML = '<p class="text-red-500 text-sm">ì´ë¯¸ì§€ í‘œì‹œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ.</p>';
          };
          detailImageContainer.innerHTML = "";
          detailImageContainer.appendChild(img);
        } else {
          throw new Error(base64Content && base64Content.startsWith("Error") ? base64Content : "ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë¯¸ì§€ ë°ì´í„°");
        }
      } catch (err) {
        console.error("ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:", err);
        detailImageContainer.innerHTML = `<p class="text-red-500 text-sm">ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨: ${err.message}</p>`;
      }
    }

    // ë³¸ë¬¸ í‘œì‹œ
    document.getElementById("detailContentDisplay").textContent = post.content || "";
    document.getElementById("detailEditForm").classList.add("hidden");
    document.getElementById("detailContentDisplay").classList.remove("hidden");

    // ì¡°íšŒìˆ˜ ì¦ê°€ (ë¹„ë™ê¸°)
    if (currentPostId) {
      try {
        await fetch(WEB_APP_URL, {
          method: "POST",
          mode: "cors",
          cache: "no-cache",
          headers: { "Content-Type": "text/plain;charset=utf-8" },
          body: JSON.stringify({ 
            action: "incrementViews", 
            data: { postId: currentPostId, communityId: currentCommunity } 
          })
        });
      } catch (err) {
        console.error("ì¡°íšŒìˆ˜ ì¦ê°€ ì‹¤íŒ¨:", err);
      }

      // ëŒ“ê¸€ ë¡œë“œ
      loadComments();
    }
  }

  function backToList() {
    document.getElementById("postDetail").classList.add("hidden");
    currentPostId = null;
    document.getElementById("detailImageContainer").innerHTML = "";
    document.getElementById("commentsList").innerHTML = "";
    document.getElementById("postWriteForm").classList.remove("hidden");
    document.getElementById("searchBox").classList.remove("hidden");
    document.getElementById("postsList").classList.remove("hidden");
    document.getElementById("pagination").classList.remove("hidden");
    document.getElementById("searchBox").value = "";
    
    if (currentCommunity) {
      loadPosts(currentPage);
    }
  }

  // ===== ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ëª¨ë‹¬ =====
  function showPasswordModal(action) {
    currentPasswordModalAction = action;
    const modal = document.getElementById('passwordModal');
    document.getElementById('modalPasswordInput').value = "";
    document.getElementById('modalPasswordError').textContent = "";
    modal.classList.add('active');
  }

  function closePasswordModal() {
    document.getElementById('passwordModal').classList.remove('active');
    currentPasswordModalAction = null;
  }

  async function submitPasswordModal() {
    const password = document.getElementById('modalPasswordInput').value;
    const errorEl = document.getElementById('modalPasswordError');

    if (!password) {
      errorEl.textContent = "ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.";
      return;
    }

    if (currentPasswordModalAction === 'edit') {
      enterEditMode(password);
      closePasswordModal();
    } else if (currentPasswordModalAction === 'delete') {
      await submitDelete(password);
    }
  }

  function enterEditMode(password) {
    const post = currentPosts.find(p => p.postId === currentPostId);
    if (!post) return;

    document.getElementById("detailContentDisplay").classList.add("hidden");
    document.getElementById("detailEditForm").classList.remove("hidden");
    document.getElementById("editContent").value = post.content;
    document.getElementById("editContent").dataset.password = password;
  }

  function cancelEdit() {
    document.getElementById("detailEditForm").classList.add("hidden");
    document.getElementById("detailContentDisplay").classList.remove("hidden");
  }

  async function submitUpdate() {
    const newContent = document.getElementById("editContent").value;
    const password = document.getElementById("editContent").dataset.password;

    if (!newContent) {
      alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");
      return;
    }

    try {
      const response = await fetch(WEB_APP_URL, {
        method: "POST",
        mode: "cors",
        cache: "no-cache",
        headers: { "Content-Type": "text/plain;charset=utf-8" },
        body: JSON.stringify({
          action: "updatePost",
          data: {
            postId: currentPostId,
            postPassword: password,
            newContent: newContent,
            communityId: currentCommunity
          }
        })
      });

      const result = await response.json();

      if (result.success) {
        alert(result.message);
        backToList();
      } else {
        alert(result.message || "ìˆ˜ì • ì‹¤íŒ¨");
      }
    } catch (err) {
      console.error("ê²Œì‹œê¸€ ìˆ˜ì • ì˜¤ë¥˜:", err);
      alert("ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
  }

  async function submitDelete(password) {
    if (!confirm("ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
      closePasswordModal();
      return;
    }

    try {
      const response = await fetch(WEB_APP_URL, {
        method: "POST",
        mode: "cors",
        cache: "no-cache",
        headers: { "Content-Type": "text/plain;charset=utf-8" },
        body: JSON.stringify({
          action: "deletePost",
          data: {
            postId: currentPostId,
            postPassword: password,
            communityId: currentCommunity
          }
        })
      });

      const result = await response.json();

      if (result.success) {
        alert(result.message);
        closePasswordModal();
        currentPage = 1;
        showMain();
        openCommunity(currentCommunity);
      } else {
        document.getElementById('modalPasswordError').textContent = result.message || "ì‚­ì œ ì‹¤íŒ¨";
      }
    } catch (err) {
      console.error("ê²Œì‹œê¸€ ì‚­ì œ ì˜¤ë¥˜:", err);
      alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
  }

  // ===== ëŒ“ê¸€ ê´€ë¦¬ =====
  async function submitComment() {
    if (!currentPostId) return;

    const commentData = {
      postId: currentPostId,
      communityId: currentCommunity,
      authorNickname: document.getElementById("commentAuthor").value || "ìµëª…",
      content: document.getElementById("commentContent").value
    };

    if (!commentData.content) {
      alert("ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");
      return;
    }

    try {
      const response = await fetch(WEB_APP_URL, {
        method: "POST",
        mode: "cors",
        cache: "no-cache",
        headers: { "Content-Type": "text/plain;charset=utf-8" },
        body: JSON.stringify({ action: "addComment", data: commentData })
      });

      const res = await response.json();

      if (res && res.success === true) {
        loadComments();
        document.getElementById("commentAuthor").value = "";
        document.getElementById("commentContent").value = "";
      } else {
        alert("ëŒ“ê¸€ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      }
    } catch (err) {
      console.error("ëŒ“ê¸€ ë“±ë¡ ì‹¤íŒ¨:", err);
      alert("ëŒ“ê¸€ ë“±ë¡ ì¤‘ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
  }

  async function loadComments() {
    if (!currentPostId) return;

    try {
      const response = await fetch(`${WEB_APP_URL}?action=getComments&postId=${currentPostId}&communityId=${encodeURIComponent(currentCommunity)}`);
      const data = await response.json();

      const container = document.getElementById("commentsList");
      container.innerHTML = "";

      if (!data || !Array.isArray(data) || data.length === 0) {
        container.innerHTML = "<p class='text-gray-500 text-sm'>ë“±ë¡ëœ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
        return;
      }

      data.forEach((c) => {
        if (!c || typeof c !== 'object') return;
        const div = document.createElement("div");
        div.className = "border-b border-gray-200 py-3";
        const author = c.authorNickname || "ìµëª…";
        const time = c.timestamp || "";
        const commentContent = c.content || "";
        div.innerHTML = `
          <p class="font-semibold">${author} <span class="text-xs text-gray-500 font-normal">(${time})</span></p>
          <p class="text-gray-700 whitespace-pre-wrap">${commentContent}</p>`;
        container.appendChild(div);
      });
    } catch (err) {
      console.error("ëŒ“ê¸€ ë¡œë“œ ì‹¤íŒ¨:", err);
      document.getElementById("commentsList").innerHTML = "<p class='text-red-500 text-sm'>ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ.</p>";
    }
  }

  // ===== ë¬¸ì˜í•˜ê¸° =====
  async function submitInquiry() {
    const content = document.getElementById("inquiryContent").value;
    const inquiryMsg = document.getElementById("inquiryMsg");
    
    if (!content || content.trim() === "") {
      inquiryMsg.textContent = "âŒ ë¬¸ì˜ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.";
      inquiryMsg.className = "mt-2 text-sm text-red-600";
      return;
    }

    inquiryMsg.textContent = "ì „ì†¡ ì¤‘...";
    inquiryMsg.className = "mt-2 text-sm text-gray-600";

    try {
      const response = await fetch(WEB_APP_URL, {
        method: "POST",
        mode: "cors",
        cache: "no-cache",
        headers: { "Content-Type": "text/plain;charset=utf-8" },
        body: JSON.stringify({ action: "addInquiry", data: { content: content } })
      });

      const res = await response.json();

      if (res && res.success === true) {
        inquiryMsg.textContent = "âœ… ë¬¸ì˜ ë“±ë¡ ì„±ê³µ!";
        inquiryMsg.className = "mt-2 text-sm text-green-600";
        document.getElementById("inquiryContent").value = "";
        setTimeout(() => {
          if (inquiryMsg.textContent === "âœ… ë¬¸ì˜ ë“±ë¡ ì„±ê³µ!") {
            inquiryMsg.textContent = "";
          }
        }, 2000);
      } else {
        inquiryMsg.textContent = res.message || "âŒ ì˜¤ë¥˜ ë°œìƒ";
        inquiryMsg.className = "mt-2 text-sm text-red-600";
      }
    } catch (err) {
      console.error("ë¬¸ì˜ ë“±ë¡ ì‹¤íŒ¨:", err);
      inquiryMsg.textContent = "âŒ ë¬¸ì˜ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ ë°œìƒ.";
      inquiryMsg.className = "mt-2 text-sm text-red-600";
    }
  }

  // ===== ì´ˆê¸°í™” ì‹¤í–‰ =====
  init();
</script>
</body>
</html>
